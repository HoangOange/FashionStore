<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Quản lý Khách hàng - FashionStore Admin</title>
  <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
  <header>
    <div class="logosec">
      <div class="logo">FashionStore Admin</div>
      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210182541/Untitled-design-(30).png" class="icn menuicn" id="menuicn" alt="menu-icon"/>
    </div>
    <div class="searchbar">
      <input type="text" placeholder="Tìm kiếm..."/>
      <div class="searchbtn">
        <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210180758/Untitled-design-(28).png" class="icn srchicn"/>
      </div>
    </div>
    <div class="message">
      <div class="circle"></div>
      <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183322/8.png" class="icn"/>
      <div class="dp">
        <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210180014/profile-removebg-preview.png" class="dpicn" alt="dp"/>
      </div>
    </div>
  </header>

  <div class="main-container">
    <div class="navcontainer" id="nav">
      <nav class="nav">
        <div class="nav-upper-options">
          <div class="nav-option">
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210182148/Untitled-design-(29).png" class="nav-img" alt="dashboard"/>
            <h3><a href="dashboard.html">Dashboard</a></h3>
          </div>
          
          <div class="nav-option">
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183322/9.png" class="nav-img" alt="products"/>
            <h3><a href="products.html">Sản phẩm</a></h3>
          </div>
          
          <div class="nav-option">
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183320/5.png" class="nav-img" alt="orders"/>
            <h3><a href="orders.html">Đơn hàng</a></h3>
          </div>
          
          <div class="nav-option option1">
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183323/10.png" class="nav-img" alt="users"/>
            <h3><a href="users.html">Khách hàng</a></h3>
          </div>
          
          <div class="nav-option logout">
            <img src="https://media.geeksforgeeks.org/wp-content/uploads/20221210183321/7.png" class="nav-img" alt="logout"/>
            <h3><a href="../index.html">Về trang chủ</a></h3>
          </div>
        </div>
      </nav>
    </div>

    <div class="main">
      <h1 class="page-title">Quản lý Khách hàng</h1>

      <div class="table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Họ và Tên</th>
              <th>Email</th>
              <th>Username</th>
              <th>Ngày đăng ký</th>
              <th>Trạng thái</th>
              <th>Hành động</th>
            </tr>
          </thead>
          <tbody id="userTableBody">
            <tr>
              <td colspan="7" style="text-align: center; padding: 20px;">Đang tải dữ liệu...</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="stats-summary">
        <div class="stat-card">
          <h3>Tổng khách hàng</h3>
          <p class="stat-number" id="totalUsers">0</p>
        </div>
        <div class="stat-card">
          <h3>Khách hàng mới (tháng này)</h3>
          <p class="stat-number" id="newUsers">0</p>
        </div>
        <div class="stat-card">
          <h3>Khách hàng hoạt động</h3>
          <p class="stat-number" id="activeUsers">0</p>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/admin.js"></script>
  <script>
    // Hiển thị danh sách khách hàng từ localStorage
    function loadUsers() {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const tbody = document.getElementById('userTableBody');
      
      if (users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px;">Chưa có khách hàng nào</td></tr>';
        return;
      }
      
      tbody.innerHTML = users.map((user, index) => {
        const date = new Date(user.createdAt || Date.now());
        const formattedDate = date.toLocaleDateString('vi-VN');
        
        return `
          <tr>
            <td>${index + 1}</td>
            <td>${user.fullname}</td>
            <td>${user.email}</td>
            <td>${user.username}</td>
            <td>${formattedDate}</td>
            <td><span class="status-badge active">Hoạt động</span></td>
            <td>
              <button class="btn-view" onclick="viewUser(${user.id})">Chi tiết</button>
              <button class="btn-delete" onclick="deleteUser(${user.id})">Xóa</button>
            </td>
          </tr>
        `;
      }).join('');
      
      // Cập nhật thống kê
      document.getElementById('totalUsers').textContent = users.length;
      
      // Tính khách hàng mới trong tháng
      const currentMonth = new Date().getMonth();
      const newUsersCount = users.filter(u => {
        const userDate = new Date(u.createdAt || Date.now());
        return userDate.getMonth() === currentMonth;
      }).length;
      document.getElementById('newUsers').textContent = newUsersCount;
      document.getElementById('activeUsers').textContent = users.length;
    }
    
    function viewUser(userId) {
      const users = JSON.parse(localStorage.getItem('users') || '[]');
      const user = users.find(u => u.id === userId);
      if (user) {
        alert(`Thông tin khách hàng:\n\nHọ tên: ${user.fullname}\nEmail: ${user.email}\nUsername: ${user.username}\nNgày đăng ký: ${new Date(user.createdAt).toLocaleDateString('vi-VN')}`);
      }
    }
    
    function deleteUser(userId) {
      if (confirm('Bạn có chắc muốn xóa khách hàng này?')) {
        let users = JSON.parse(localStorage.getItem('users') || '[]');
        users = users.filter(u => u.id !== userId);
        localStorage.setItem('users', JSON.stringify(users));
        loadUsers();
        alert('Đã xóa khách hàng!');
      }
    }
    
    // Load users khi trang được tải
    document.addEventListener('DOMContentLoaded', loadUsers);
  </script>
</body>
</html>